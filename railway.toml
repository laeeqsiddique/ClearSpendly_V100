[build]
builder = "nixpacks"
buildCommand = "npm ci && npm run build"
watchPatterns = ["package.json", "package-lock.json", "next.config.ts", "tsconfig.json"]

[build.environment]
NODE_ENV = "production"
NEXT_TELEMETRY_DISABLED = "1"
CI = "true"
# Railway-specific build optimizations
NODE_OPTIONS = "--max-old-space-size=4096"
# Disable problematic features during build
DISABLE_ESLINT_PLUGIN = "true"

[deploy]
startCommand = "npm run start"
healthcheckPath = "/api/health"
healthcheckTimeout = 300
restartPolicyType = "on_failure"
restartPolicyMaxRetries = 3

[deploy.environment]
NODE_ENV = "production"
PORT = "3000"
NEXT_TELEMETRY_DISABLED = "1"
# Railway-specific runtime optimizations
NODE_OPTIONS = "--max-old-space-size=2048"

[scaling]
minReplicas = 1
maxReplicas = 2